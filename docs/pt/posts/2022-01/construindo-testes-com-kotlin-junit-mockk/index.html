<!doctype html><html lang=pt><head><meta charset=utf-8><title>Construindo testes com Kotlin, JUnit e MockK - rapatao.com</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=https://www.rapatao.com/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.rapatao.com/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.rapatao.com/favicon/favicon-16x16.png><link rel=manifest href=https://www.rapatao.com/favicon/site.webmanifest><link rel=mask-icon href=https://www.rapatao.com/favicon/safari-pinned-tab.svg color=#ffffff><link rel="shortcut icon" href=https://www.rapatao.com/favicon/favicon.ico><meta name=msapplication-config content="/favicon/browserconfig.xml"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.101.0"><meta itemprop=name content="Construindo testes com Kotlin, JUnit e MockK"><meta itemprop=description content="A construÃ§Ã£o de testes de cÃ³digo em uma aplicaÃ§Ã£o tem como principal objetivo certificar o que foi codificado, ou seja, garantir que um determinado trecho de cÃ³digo faz o que deveria fazer.
JUnit Ã© um dos frameworks mais utilizados na construÃ§Ã£o de testes em Kotlin e MockK para construÃ§Ã£o de mocks, que seriam como dublÃªs de um objeto e tem como funÃ§Ã£o simular o comportamento de um componente.
ğŸ’¡ Os cÃ³digo utilizados nesse texto estÃ£o disponÃ­veis no GitHub: https://github."><meta itemprop=datePublished content="2022-01-19T22:00:00-03:00"><meta itemprop=dateModified content="2022-01-19T22:00:00-03:00"><meta itemprop=wordCount content="1334"><meta itemprop=image content><meta itemprop=keywords content="kotlin,junit,mockk,tests,"><meta property="og:title" content="Construindo testes com Kotlin, JUnit e MockK"><meta property="og:description" content="A construÃ§Ã£o de testes de cÃ³digo em uma aplicaÃ§Ã£o tem como principal objetivo certificar o que foi codificado, ou seja, garantir que um determinado trecho de cÃ³digo faz o que deveria fazer.
JUnit Ã© um dos frameworks mais utilizados na construÃ§Ã£o de testes em Kotlin e MockK para construÃ§Ã£o de mocks, que seriam como dublÃªs de um objeto e tem como funÃ§Ã£o simular o comportamento de um componente.
ğŸ’¡ Os cÃ³digo utilizados nesse texto estÃ£o disponÃ­veis no GitHub: https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://www.rapatao.com/pt/posts/2022-01/construindo-testes-com-kotlin-junit-mockk/"><meta property="og:image" content="https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-19T22:00:00-03:00"><meta property="article:modified_time" content="2022-01-19T22:00:00-03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg"><meta name=twitter:title content="Construindo testes com Kotlin, JUnit e MockK"><meta name=twitter:description content="A construÃ§Ã£o de testes de cÃ³digo em uma aplicaÃ§Ã£o tem como principal objetivo certificar o que foi codificado, ou seja, garantir que um determinado trecho de cÃ³digo faz o que deveria fazer.
JUnit Ã© um dos frameworks mais utilizados na construÃ§Ã£o de testes em Kotlin e MockK para construÃ§Ã£o de mocks, que seriam como dublÃªs de um objeto e tem como funÃ§Ã£o simular o comportamento de um componente.
ğŸ’¡ Os cÃ³digo utilizados nesse texto estÃ£o disponÃ­veis no GitHub: https://github."><meta name=twitter:site content="@rapatao"><link rel=stylesheet href=https://www.rapatao.com/css/bundle.min.465c91a755fc5a687079f9888343809dd9305d843e08bb26f421b4b62b4ed6e8.css integrity="sha256-RlyRp1X8WmhwefmIg0OAndkwXYQ+CLsm9CG0titO1ug="><link rel=stylesheet href=https://www.rapatao.com/css/add-on.css></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=https://www.rapatao.com/pt/ class=nav>rapatao.com</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=https://www.rapatao.com/pt/posts/ class="nav link"><i class='far fa-newspaper'></i> Blog</a>
<a href=https://www.rapatao.com/pt/resume/ class="nav link"><i class='far fa-file-alt'></i> ExperiÃªncia</a>
<a href=https://www.rapatao.com/pt/json/ class="nav link"><i class='far fa-file-code'></i> JSON Formatter & Minifier</a>
<a href=#share-menu class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
<a href=#search-input class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a></menu>
<a href=#search-input class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
<a href=#share-menu class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
<a href=#lang-menu class="nav lang-toggle" lang=pt>pt</a>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id=search class=menu><input id=search-input class="search-input menu"></input><div id=search-results class="search-results menu"></div></menu><menu id=lang-menu class="flyout-menu menu"><a href=# lang=pt class="nav link active">PortuguÃªs (pt)</a>
<a href=https://www.rapatao.com/posts/2022-01/build-tests-using-kotlin-junit-mockk/ lang=en class="nav link">English (en)</a></menu>
<menu id=share-menu class="flyout-menu menu"><h1>Share Post</h1><a href="//twitter.com/share?text=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK&url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn facebook"><p>Facebook</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&title=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&title=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn linkedin"><p>LinkedIn</p></a><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&description=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn pinterest"><p>Pinterest</p></a><a href="mailto:?subject=Confira%20esta%20postagem%20por %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&body=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></menu></header><div id=wrapper><section id=site-intro><a href=https://www.rapatao.com/pt/><img src=https://www.rapatao.com/images/avatar-pixel.gif class=square width=100 alt="Luiz H. RapatÃ£o"></a><header><h1>Luiz H. RapatÃ£o</h1></header><main><p>Senior Software Engineer</p></main><footer><ul class=socnet-icons><li><a href=//github.com/rapatao target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//linkedin.com/in/rapatao target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//instagram.com/luizrapatao target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/rapatao target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=skype:rapatao?userinfo target=_blank rel=noopener title=Skype class="fab fa-skype"></a></li><li><a href=mailto:rapatao@rapatao.com target=_blank title=Email class="far fa-envelope"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=https://www.rapatao.com/pt/posts/2022-01/construindo-testes-com-kotlin-junit-mockk/>Construindo testes com Kotlin, JUnit e MockK</a></h2></div><div class=meta><time datetime="2022-01-19 22:00:00 -0300 -03">19 de January, 2022</time><p>7 Minutos De Leitura</p></div></header><div id=socnet-share><a href="//twitter.com/share?text=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK&url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn facebook"><p>Facebook</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&title=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&title=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn linkedin"><p>LinkedIn</p></a><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f&description=Construindo%20testes%20com%20Kotlin%2c%20JUnit%20e%20MockK" target=_blank rel=noopener class="nav share-btn pinterest"><p>Pinterest</p></a><a href="mailto:?subject=Confira%20esta%20postagem%20por %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&body=https%3a%2f%2fwww.rapatao.com%2fpt%2fposts%2f2022-01%2fconstruindo-testes-com-kotlin-junit-mockk%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></div><div class=content><a href=https://www.rapatao.com/pt/posts/2022-01/construindo-testes-com-kotlin-junit-mockk/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg')"><img src=https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg alt="Construindo testes com Kotlin, JUnit e MockK"></a><p>A construÃ§Ã£o de testes de cÃ³digo em uma aplicaÃ§Ã£o tem como principal objetivo certificar o que foi codificado, ou seja, garantir que um determinado trecho de cÃ³digo faz o que deveria fazer.</p><p><a href=https://junit.org/junit5/>JUnit</a> Ã© um dos frameworks mais utilizados na construÃ§Ã£o de testes em <a href=https://kotlinlang.org/>Kotlin</a> e <a href=https://mockk.io/>MockK</a> para construÃ§Ã£o de <em>mocks</em>, que seriam como dublÃªs de um objeto e tem como funÃ§Ã£o simular o comportamento de um componente.</p><aside>ğŸ’¡ Os cÃ³digo utilizados nesse texto estÃ£o disponÃ­veis no GitHub: https://github.com/rapatao/blog-koltin-junit-mockk</aside><h2 id=dependÃªncias-utilizadas>DependÃªncias utilizadas</h2><p>Ã‰ importante dizer que, existem diversas formas de adicionar suporte a linguagem e frameworks que iremos utilizar neste texto. No exemplo abaixo, serÃ¡ apresentado apenas uma delas, sendo basicamente como o <em><a href=https://www.jetbrains.com/idea/>IntelliJ IDEA</a></em> inicializa projetos em <em>Kotlin</em> + <em><a href=https://gradle.org/>Gradle</a></em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#34;org.jetbrains.kotlin.jvm&#34;</span> version <span style=color:#e6db74>&#34;1.6.10&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-stdlib&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    testImplementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.junit.jupiter:junit-jupiter:5.8.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    testImplementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;io.mockk:mockk:1.12.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>test <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    useJUnitPlatform<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Antes de adicionar essas configuraÃ§Ãµes ao seu projeto, Ã© sempre importante verificar se as mesmas jÃ¡ nÃ£o estÃ£o presentes em seu projeto. Isso pode ser feito atravÃ©s da <em>task</em> <code>:dependencies</code>, tanto atravÃ©s de alguma IDE como por terminal, com o seguinte comando:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gradle dependencies
</span></span></code></pre></div><p>Com o resultado do comando, basta procurar pelas dependÃªncias, se as encontrar, sua configuraÃ§Ã£o estÃ¡ correta.</p><h2 id=o-cÃ³digo-a-ser-testado>O cÃ³digo a ser testado</h2><p>Como a ideia principal Ã© demonstrar a construÃ§Ã£o de testes utilizando <em>Kotlin</em>, <em>JUnit</em> e <em>MockK</em>, o cÃ³digo utilizado Ã© extremamente simples, porÃ©m atravÃ©s dele serÃ¡ possÃ­vel demonstrar nÃ£o sÃ³ a criaÃ§Ã£o de testes utilizando <em>JUnit</em>, como a construÃ§Ã£o de <em>mocks</em> atravÃ©s de <em>MockK</em>, entre outros detalhes que iremos detalhar no decorrer do texto.</p><p><em><strong>CalculatorService.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CalculatorService</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>sum</span>(a: Int, b: Int) = a + b
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>multi</span>(a: Int, b: Int) = a * b
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em><strong>OpType.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OpType</span> {
</span></span><span style=display:flex><span>    SUM, MULTI
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em><strong>MainService.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainService</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>execute</span>(a: Int, b: Int, op: OpType) =
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>when</span> (op) {
</span></span><span style=display:flex><span>            OpType.SUM <span style=color:#f92672>-&gt;</span> calculatorService.sum(a, b)
</span></span><span style=display:flex><span>            OpType.MULTI <span style=color:#f92672>-&gt;</span> calculatorService.multi(a, b)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=o-primeiro-teste>O primeiro teste</h2><p>A declaraÃ§Ã£o de testes com <em>JUnit</em> Ã© feito atravÃ©s da anotaÃ§Ã£o <code>org.junit.jupiter.api.Test</code>adicionada em uma funÃ§Ã£o que descreve o cenÃ¡rio a ser executado, conforme exemplo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ClassTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>test</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// test block
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>De maneira geral, todo teste verifica se algo ocorreu conforme esperado. Existem diversas formas se fazer isso, mas sÃ£o normalmente feitas atravÃ©s dos mÃ©todos existentes na classe <code>org.junit.jupiter.api.Assertions</code>, como, por exemplo, o <code>assertEquals</code>. Outros mÃ©todos existem, e podem ser verificados <a href=https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Assertions.html>aqui</a>.</p><p>Com base no cÃ³digo apresentado anteriormente, podemos criar alguns cenÃ¡rios de testes, porÃ©m irei descrever apenas dois, que irÃ£o basicamente realizar testes simples com as operaÃ§Ãµes <code>SUM</code> e <code>MULTI</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions.assertEquals
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SimpleTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2+3 deve ser 5`</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.SUM)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assertEquals(<span style=color:#ae81ff>5</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2*3 deve ser 6`</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.MULTI)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assertEquals(<span style=color:#ae81ff>6</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Apesar de simples, esses testes demonstram como Ã© realizado a construÃ§Ã£o de testes, que basicamente consiste em, criar as instÃ¢ncias necessÃ¡rias, invocar a funÃ§Ã£o a ser testada e comparado seu resultado.</p><h2 id=reduzindo-cÃ³digo-duplicado-nos-testes>Reduzindo cÃ³digo duplicado nos testes</h2><p>Como pode ser notado, ambos cenÃ¡rios realizam a construÃ§Ã£o de uma instÃ¢ncia da classe a ser testada e, consequentemente, de suas dependÃªncias. Com o <em>JUnit</em>, casos assim, poderiam ser construÃ­do declarando uma funÃ§Ã£o anotaÃ§Ãµes especificas, executadas antes ou apÃ³s um, ou todos os cenÃ¡rios de testes declarados.</p><p>Essas anotaÃ§Ãµes sÃ£o utilizadas quando precisamos preparar ou remover dados antes ou depois da execuÃ§Ã£o dos cenÃ¡rios de testes, como, por exemplo, realizar inserÃ§Ã£o de dados em uma base de dados, ou apagar informaÃ§Ãµes inseridas nesta mesma base.</p><p>As anotaÃ§Ãµes existentes e seus comportamentos sÃ£o descritos a seguir:</p><ul><li><code>org.junit.jupiter.api.BeforeAll</code>: Executa <strong>antes</strong> de <strong>todos</strong> os cenÃ¡rios de teste</li><li><code>org.junit.jupiter.api.AfterEach</code>: Executa <strong>antes</strong> de <strong>cada</strong> cenÃ¡rio de teste</li><li><code>org.junit.jupiter.api.AfterEach</code>: Executa <strong>depois</strong> de <strong>cada</strong> cenÃ¡rio de teste</li><li><code>org.junit.jupiter.api.AfterAll</code>: Executa <strong>depois</strong> de <strong>todos</strong> os cenÃ¡rios de testes</li></ul><p>Conhecendo essas anotaÃ§Ãµes, podemos reescrever os cenÃ¡rios anteriores da seguinte maneira:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithBeforeTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=simulando-chamadas-em-outras-classes>Simulando chamadas em outras classes</h2><p>Muitos testes podem ser construÃ­dos com utilizaÃ§Ã£o de dependÃªncias &ldquo;reais&rdquo;, ou seja, com suas instÃ¢ncias, porÃ©m, alguns casos isso pode nÃ£o ser possÃ­vel, uma vez que essas instÃ¢ncias podem necessitar ou acessar recursos que nÃ£o estÃ£o disponÃ­veis durante a execuÃ§Ã£o dos testes.</p><p>Nesses casos, utilizamos ferramentas que criam <em>mocks</em>, que podem ser entendidos como instÃ¢ncias que simulam o comportamento de uma instÃ¢ncia real. Essa simulaÃ§Ã£o Ã© normalmente declarada explicitamente e seria algo como: &ldquo;quando o mÃ©todo A for invocado com determinados parÃ¢metros, B deverÃ¡ ser retornado&rdquo;.</p><p>Utilizando nossas classes de exemplo, podemos escrever os testes da seguinte maneira:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.mockk
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithBeforeTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        calculatorService = mockk()
</span></span><span style=display:flex><span>        mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2+3 deve ser 5`</span>() {
</span></span><span style=display:flex><span>        every { calculatorService.sum(any(), any()) } returns <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.SUM)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assertions.assertEquals(<span style=color:#ae81ff>5</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2*3 deve ser 6`</span>() {
</span></span><span style=display:flex><span>        every { calculatorService.multi(any(), any()) } returns <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.MULTI)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assertions.assertEquals(<span style=color:#ae81ff>6</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note que, agora antes de invocar o mÃ©todo <code>execute</code>, dizemos como o <em>mock</em> deve se comportar ao ser consumido. Apesar de nÃ£o tem muito sentido em nosso exemplo, considerado a simplicidade de nosso cÃ³digo, isso pode ser extremamente Ãºtil quando precisamos simular o uso de um <em>SDK</em> terceiro que nÃ£o fornece meios para criaÃ§Ã£o de testes, o que poderia impossibilitar a criaÃ§Ã£o de testes, caso nÃ£o seja utilizado <em>mocks.</em></p><h2 id=criando-mocks-com-anotaÃ§Ãµes>Criando mocks com anotaÃ§Ãµes</h2><p>O framework <em>MockK</em>, fornece um conjunto de anotaÃ§Ãµes que podem ser utilizadas para criaÃ§Ã£o dos <em>mocks</em> e os injetar na classe a ser testada, sem que esse processo seja explicitamente realizado. Esse recurso Ã© Ãºtil quando necessitamos criar diversos <em>mocks</em> para construÃ§Ã£o dos testes e sua construÃ§Ã£o Ã© feita atravÃ©s da adiÃ§Ã£o de anotaÃ§Ãµes <code>io.mockk.impl.annotations.MockK</code> e <code>io.mockk.impl.annotations.InjectMockKs</code> nas variÃ¡veis declaradas na classe de teste.</p><p>ApÃ³s isso, devemos alterar no mÃ©todo <code>setup</code> para inicializar essas variÃ¡veis, como podemos ver seguir:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.MockKAnnotations
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.InjectMockKs
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.MockK
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithMockKAnnotationTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MockK</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InjectMockKs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        MockKAnnotations.<span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=reduzindo-cÃ³digo-na-criaÃ§Ã£o-de-mocks>Reduzindo cÃ³digo na criaÃ§Ã£o de mocks</h2><p>O JUnit oferece um recurso interessante chamado de <em><a href=https://junit.org/junit5/docs/current/user-guide/#extensions>Extensions</a></em>. Com esse recurso, podemos estender o comportamento do framework de testes, delegando diversos comportamentos que possa ser necessÃ¡rio para a execuÃ§Ã£o dos cenÃ¡rios de testes.</p><p>Frameworks populares como <em>Spring</em>, atravÃ©s da <code>@SpringBootTest</code> e <em>Micronaut</em>, com <code>@MicronautTest</code>fazem uso desse recurso para inicializar o contexto antes da execuÃ§Ã£o dos cenÃ¡rios.</p><p>O framework <em>MockK</em> tambÃ©m oferece suporte a esse recurso, porÃ©m, nÃ£o utilizando uma anotaÃ§Ã£o especÃ­fica, mas sim, por uma declaraÃ§Ã£o explicita do recurso do JUnit, que consiste em adicionar a seguinte anotaÃ§Ã£o a classe dos testes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@org</span>.junit.jupiter.api.extension.ExtendWith(MockKExtension<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span></code></pre></div><p>Com sua utilizaÃ§Ã£o, nÃ£o precisamos mais, em nossa classe de teste, nÃ£o precisamos mais declara o mÃ©todo <code>setup</code>, deixando nossa classe de teste da seguinte maneira:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.InjectMockKs
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.MockK
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.junit5.MockKExtension
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.extension.ExtendWith
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ExtendWith</span>(MockKExtension<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithMockKExtensionTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MockK</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InjectMockKs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusÃ£o>ConclusÃ£o</h2><p>Nesse texto abordamos as dependÃªncias necessÃ¡rias para construÃ§Ã£o de testes com Kotlin, utilizando as ferramentas JUnit e MockK. Descrevemos tambÃ©m como construir mÃ©todos, executados antes e depois dos casos de testes, bem como a criaÃ§Ã£o de <em>mocks</em> para casos onde nÃ£o podemos utilizar uma implementaÃ§Ã£o real.</p><p>Espero que tenha ajudado a compreender como construir testes utilizando essas ferramentas, bem como a otimizar sua construÃ§Ã£o, demonstrando como reduzir a quantidade de cÃ³digo necessÃ¡rio para construÃ§Ã£o dos casos de testes.</p><p>AgradeÃ§o a leitura e sinta-se a vontade em questionar sobre o assunto.</p></div><footer><div class=stats><ul class=tags><li><a class=article-terms-link href=https://www.rapatao.com/pt/tags/kotlin/>kotlin</a></li><li><a class=article-terms-link href=https://www.rapatao.com/pt/tags/junit/>junit</a></li><li><a class=article-terms-link href=https://www.rapatao.com/pt/tags/mockk/>mockk</a></li><li><a class=article-terms-link href=https://www.rapatao.com/pt/tags/tests/>tests</a></li></ul></div></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//rapatao-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><div class=pagination><a href=https://www.rapatao.com/pt/posts/2022-02/load-balancing-o-que-e-um-balanceador-de-carga/ class="button left"><span>Load Balancing: O que Ã© um balanceador de carga?</span></a>
<a href=https://www.rapatao.com/pt/posts/2021-06/otimizando-testes-em-aplicacoes-com-spring-boot/ class="button right"><span>Otimizando testes em aplicaÃ§Ãµes com Spring Boot</span></a></div></main><section id=site-sidebar><section id=recent-posts><header><h1>Posts Recentes</h1></header><article class=mini-post><a href=https://www.rapatao.com/pt/posts/2022-08/o-que-sao-flaky-tests-e-porque-corrigi-los/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/flaky-pipeline.png')"><img src=https://www.rapatao.com/images/posts/flaky-pipeline.png alt="O que sÃ£o Flaky Tests e, porque corrigi-los!"></a><header><h2><a href=https://www.rapatao.com/pt/posts/2022-08/o-que-sao-flaky-tests-e-porque-corrigi-los/>O que sÃ£o Flaky Tests e, porque corrigi-los!</a></h2><time class=published datetime="2022-08-28 12:00:00 -0300 -03">28 de August, 2022</time></header></article><article class=mini-post><a href=https://www.rapatao.com/pt/posts/2022-07/gnupg-como-fazer-backup-e-restaurar-suas-chaves/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-lucas-seebacher-5599449.jpeg')"><img src=https://www.rapatao.com/images/posts/pexels-lucas-seebacher-5599449.jpeg alt="GnuPG: como fazer backup e restaurar suas chaves?"></a><header><h2><a href=https://www.rapatao.com/pt/posts/2022-07/gnupg-como-fazer-backup-e-restaurar-suas-chaves/>GnuPG: como fazer backup e restaurar suas chaves?</a></h2><time class=published datetime="2022-07-31 12:00:00 -0300 -03">31 de July, 2022</time></header></article><article class=mini-post><a href=https://www.rapatao.com/pt/posts/2022-04/o-que-e-uma-cdn-content-delivery-network/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-pixabay-163064.jpeg')"><img src=https://www.rapatao.com/images/posts/pexels-pixabay-163064.jpeg alt="O que Ã© uma CDN (Content Delivery Network)?"></a><header><h2><a href=https://www.rapatao.com/pt/posts/2022-04/o-que-e-uma-cdn-content-delivery-network/>O que Ã© uma CDN (Content Delivery Network)?</a></h2><time class=published datetime="2022-04-21 19:00:00 -0300 -03">21 de April, 2022</time></header></article><footer><a href=https://www.rapatao.com/pt/posts/ class=button>Veja Mais</a></footer></section></section><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/rapatao target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//linkedin.com/in/rapatao target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//instagram.com/luizrapatao target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/rapatao target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=skype:rapatao?userinfo target=_blank rel=noopener title=Skype class="fab fa-skype"></a></li><li><a href=mailto:rapatao@rapatao.com target=_blank title=Email class="far fa-envelope"></a></li></ul><p class=copyright>Â© 2022 rapatao.com<br>Tema: <a href=https://themes.gohugo.io/hugo-future-imperfect-slim/ target=_blank rel=noopener>Hugo Future Imperfect</a><br>Adaptado de <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP</a> | Disponibilizado pelo <a href=https://gohugo.io/ title=0.101.0 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a>
<script src=https://www.rapatao.com/js/highlight.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://www.rapatao.com/js/bundle.min.952cb158e7f5f2ed29e105fa1275ab4888785b2b0c0993cc5d3bd09f183bf078.js integrity="sha256-lSyxWOf18u0p4QX6EnWrSIh4WysMCZPMXTvQnxg78Hg="></script>
<script src=https://www.rapatao.com/js/add-on.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LDJ57WEQPH"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LDJ57WEQPH",{anonymize_ip:!0})}</script></div></body></html>
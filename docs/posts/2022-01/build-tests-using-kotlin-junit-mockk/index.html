<!doctype html><html lang=en><head><meta charset=utf-8><title>Build tests using Kotlin, JUnit and MockK - rapatao.com</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=https://www.rapatao.com/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.rapatao.com/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.rapatao.com/favicon/favicon-16x16.png><link rel=manifest href=https://www.rapatao.com/favicon/site.webmanifest><link rel=mask-icon href=https://www.rapatao.com/favicon/safari-pinned-tab.svg color=#ffffff><link rel="shortcut icon" href=https://www.rapatao.com/favicon/favicon.ico><meta name=msapplication-config content="/favicon/browserconfig.xml"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.101.0"><meta itemprop=name content="Build tests using Kotlin, JUnit and MockK"><meta itemprop=description content="The main objective of building code tests in an application is to certify what was coded, that is, to guarantee that a given piece of code does what it should do.
JUnit is one of the most used frameworks for building tests in Kotlin and [MockK](https://mockk. io/) to build mocks, which would be like doubles of an object and have the function of simulating the behavior of a component.
ðŸ’¡ The codes used in this text are available on GitHub: https://github."><meta itemprop=datePublished content="2022-01-19T22:00:00-03:00"><meta itemprop=dateModified content="2022-01-19T22:00:00-03:00"><meta itemprop=wordCount content="1340"><meta itemprop=image content><meta itemprop=keywords content="kotlin,junit,mockk,tests,"><meta property="og:title" content="Build tests using Kotlin, JUnit and MockK"><meta property="og:description" content="The main objective of building code tests in an application is to certify what was coded, that is, to guarantee that a given piece of code does what it should do.
JUnit is one of the most used frameworks for building tests in Kotlin and [MockK](https://mockk. io/) to build mocks, which would be like doubles of an object and have the function of simulating the behavior of a component.
ðŸ’¡ The codes used in this text are available on GitHub: https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://www.rapatao.com/posts/2022-01/build-tests-using-kotlin-junit-mockk/"><meta property="og:image" content="https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-19T22:00:00-03:00"><meta property="article:modified_time" content="2022-01-19T22:00:00-03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg"><meta name=twitter:title content="Build tests using Kotlin, JUnit and MockK"><meta name=twitter:description content="The main objective of building code tests in an application is to certify what was coded, that is, to guarantee that a given piece of code does what it should do.
JUnit is one of the most used frameworks for building tests in Kotlin and [MockK](https://mockk. io/) to build mocks, which would be like doubles of an object and have the function of simulating the behavior of a component.
ðŸ’¡ The codes used in this text are available on GitHub: https://github."><meta name=twitter:site content="@rapatao"><link rel=stylesheet href=https://www.rapatao.com/css/bundle.min.465c91a755fc5a687079f9888343809dd9305d843e08bb26f421b4b62b4ed6e8.css integrity="sha256-RlyRp1X8WmhwefmIg0OAndkwXYQ+CLsm9CG0titO1ug="><link rel=stylesheet href=https://www.rapatao.com/css/add-on.css></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=https://www.rapatao.com/ class=nav>rapatao.com</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=https://www.rapatao.com/pt/posts/ class="nav link"><i class='far fa-newspaper'></i> Blog</a>
<a href=https://www.rapatao.com/resume/ class="nav link"><i class='far fa-file-alt'></i> Resume</a>
<a href=https://www.rapatao.com/json/ class="nav link"><i class='far fa-file-code'></i> JSON Formatter & Minifier</a>
<a href=#share-menu class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
<a href=#search-input class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a></menu>
<a href=#search-input class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
<a href=#share-menu class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
<a href=#lang-menu class="nav lang-toggle" lang=en>en</a>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id=search class=menu><input id=search-input class="search-input menu"></input><div id=search-results class="search-results menu"></div></menu><menu id=lang-menu class="flyout-menu menu"><a href=# lang=en class="nav link active">English (en)</a>
<a href=https://www.rapatao.com/pt/posts/2022-01/construindo-testes-com-kotlin-junit-mockk/ lang=pt class="nav link">PortuguÃªs (pt)</a></menu>
<menu id=share-menu class="flyout-menu menu"><h1>Share Post</h1><a href="//twitter.com/share?text=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK&url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn facebook"><p>Facebook</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&title=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&title=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn linkedin"><p>LinkedIn</p></a><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&description=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn pinterest"><p>Pinterest</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&body=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></menu></header><div id=wrapper><section id=site-intro><a href=https://www.rapatao.com/><img src=https://www.rapatao.com/images/avatar-pixel.gif class=square width=100 alt="Luiz H. RapatÃ£o"></a><header><h1>Luiz H. RapatÃ£o</h1></header><main><p>Senior Software Engineer</p></main><footer><ul class=socnet-icons><li><a href=//github.com/rapatao target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//linkedin.com/in/rapatao target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//instagram.com/luizrapatao target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/rapatao target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=skype:rapatao?userinfo target=_blank rel=noopener title=Skype class="fab fa-skype"></a></li><li><a href=mailto:rapatao@rapatao.com target=_blank title=Email class="far fa-envelope"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=https://www.rapatao.com/posts/2022-01/build-tests-using-kotlin-junit-mockk/>Build tests using Kotlin, JUnit and MockK</a></h2></div><div class=meta><time datetime="2022-01-19 22:00:00 -0300 -03">January 19, 2022</time><p>7-Minute Read</p></div></header><div id=socnet-share><a href="//twitter.com/share?text=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK&url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn twitter"><p>Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank rel=noopener class="nav share-btn facebook"><p>Facebook</p></a><a href="//www.reddit.com/submit?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&title=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn reddit"><p>Reddit</p></a><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&title=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn linkedin"><p>LinkedIn</p></a><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f&description=Build%20tests%20using%20Kotlin%2c%20JUnit%20and%20MockK" target=_blank rel=noopener class="nav share-btn pinterest"><p>Pinterest</p></a><a href="mailto:?subject=Check%20out%20this%20post%20by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&body=https%3a%2f%2fwww.rapatao.com%2fposts%2f2022-01%2fbuild-tests-using-kotlin-junit-mockk%2f" target=_blank class="nav share-btn email" data-proofer-ignore><p>Email</p></a></div><div class=content><a href=https://www.rapatao.com/posts/2022-01/build-tests-using-kotlin-junit-mockk/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg')"><img src=https://www.rapatao.com/images/posts/pexels-pixabay-163016.jpg alt="Build tests using Kotlin, JUnit and MockK"></a><p>The main objective of building code tests in an application is to certify what was coded, that is, to guarantee that a given piece of code does what it should do.</p><p><a href=https://junit.org/junit5/>JUnit</a> is one of the most used frameworks for building tests in <a href=https://kotlinlang.org/>Kotlin</a> and [MockK](https://mockk. io/) to build <em>mocks</em>, which would be like doubles of an object and have the function of simulating the behavior of a component.</p><aside>ðŸ’¡ The codes used in this text are available on GitHub: https://github.com/rapatao/blog-koltin-junit-mockk</aside><h2 id=dependÃªncias-utilizadas>DependÃªncias utilizadas</h2><p>It is important to say that there are several ways to add support to the language and frameworks that we will use in this text. In the example below, only one of them will be presented, being basically how <em><a href=https://www.jetbrains.com/idea/>IntelliJ IDEA</a></em> initializes projects in <em>Kotlin</em> + <em>[Gradle](https:// gradle.org/)</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>plugins <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    id <span style=color:#e6db74>&#34;org.jetbrains.kotlin.jvm&#34;</span> version <span style=color:#e6db74>&#34;1.6.10&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-stdlib&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    testImplementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.junit.jupiter:junit-jupiter:5.8.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    testImplementation<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;io.mockk:mockk:1.12.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>test <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    useJUnitPlatform<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Before adding these settings to your project, it is always important to verify that they are not already present in your project. This can be done through the <em>task</em> <code>:dependencies</code>, either through an IDE or through a terminal, with the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gradle dependencies
</span></span></code></pre></div><p>With the output of the command, just look for the dependencies, if you find them, your configuration is correct.</p><h2 id=the-code-to-be-tested>The code to be tested</h2><p>As the main idea is to demonstrate the construction of tests using <em>Kotlin</em>, <em>JUnit</em> and <em>MockK</em>, the code used is extremely simple, but through it it will be possible to demonstrate not only the creation of tests using <em>JUnit</em>, but also the construction <em>mocks</em> through <em>MockK</em>, among other details that we will detail throughout the text.</p><p><em><strong>CalculatorService.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CalculatorService</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>sum</span>(a: Int, b: Int) = a + b
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>multi</span>(a: Int, b: Int) = a * b
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em><strong>OpType.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OpType</span> {
</span></span><span style=display:flex><span>    SUM, MULTI
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em><strong>MainService.kt</strong></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainService</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>execute</span>(a: Int, b: Int, op: OpType) =
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>when</span> (op) {
</span></span><span style=display:flex><span>            OpType.SUM <span style=color:#f92672>-&gt;</span> calculatorService.sum(a, b)
</span></span><span style=display:flex><span>            OpType.MULTI <span style=color:#f92672>-&gt;</span> calculatorService.multi(a, b)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=the-first-test>The first test</h2><p>The declaration of tests with <em>JUnit</em> is done through the annotation <code>org.junit.jupiter.api.Test</code> added to a function that describes the scenario to be executed, as in the example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ClassTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>test</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// test block
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In general, every test verifies that something went as expected. There are several ways to do this, but they are usually done through the existing methods in the <code>org.junit.jupiter.api.Assertions</code> class, such as <code>assertEquals</code>. Other methods exist, and can be checked <a href=https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Assertions.html>here</a>.</p><p>Based on the code presented above, we can create some test scenarios, but I will describe only two, which will basically perform simple tests with the <code>SUM</code> and <code>MULTI</code> operations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions.assertEquals
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SimpleTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2+3 deve ser 5`</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.SUM)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assertEquals(<span style=color:#ae81ff>5</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2*3 deve ser 6`</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.MULTI)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assertEquals(<span style=color:#ae81ff>6</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Despite being simple, these tests demonstrate how the construction of tests is carried out, which basically consists of creating the necessary instances, invoking the function to be tested and comparing its result.</p><h2 id=reducing-duplicate-code-in-tests>Reducing duplicate code in tests</h2><p>As can be seen, both scenarios perform the construction of an instance of the class to be tested and, consequently, of its dependencies. With <em>JUnit</em>, such cases could be constructed by declaring a specific annotation function, which is executed before or after one or all of the declared test scenarios.</p><p>These annotations are used when we need to prepare or remove data before or after the execution of test scenarios, such as, for example, inserting data into a database, or deleting information inserted in this same database.</p><p>Existing annotations and their behavior are described below:</p><ul><li><code>org.junit.jupiter.api.BeforeAll</code>: Runs <strong>before</strong> <strong>all</strong> test scenarios</li><li><code>org.junit.jupiter.api.AfterEach</code>: Runs <strong>before</strong> <strong>each</strong> test scenario</li><li><code>org.junit.jupiter.api.AfterEach</code>: Run <strong>after</strong> <strong>each</strong> test scenario</li><li><code>org.junit.jupiter.api.AfterAll</code>: Run <strong>after</strong> <strong>all</strong> test scenarios</li></ul><p>Knowing these annotations, we can rewrite the previous scenarios as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithBeforeTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        calculatorService = CalculatorService()
</span></span><span style=display:flex><span>        mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=simulating-calls-on-other-classes>Simulating calls on other classes</h2><p>Many tests can be built using &ldquo;real&rdquo; dependencies, that is, with their instances, however, in some cases this may not be possible, since these instances may need or access resources that are not available during the execution of the tests.</p><p>In these cases, we use tools that create <em>mocks</em>, which can be understood as instances that simulate the behavior of a real instance. This simulation is normally declared explicitly and would be something like: &ldquo;when method A is invoked with certain parameters, B should be returned&rdquo;.</p><p>Using our example classes, we can write the tests as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.mockk
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithBeforeTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        calculatorService = mockk()
</span></span><span style=display:flex><span>        mainService = MainService(calculatorService)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2+3 deve ser 5`</span>() {
</span></span><span style=display:flex><span>        every { calculatorService.sum(any(), any()) } returns <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.SUM)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assertions.assertEquals(<span style=color:#ae81ff>5</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>`o resultado de 2*3 deve ser 6`</span>() {
</span></span><span style=display:flex><span>        every { calculatorService.multi(any(), any()) } returns <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> result = mainService.execute(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, OpType.MULTI)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Assertions.assertEquals(<span style=color:#ae81ff>6</span>, result)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note that now, before invoking the <code>execute</code> method, we say how <em>mock</em> should behave when consumed. Although it doesn&rsquo;t make much sense in our example, considering the simplicity of our code, this can be extremely useful when we need to simulate the use of a third party <em>SDK</em> that doesn&rsquo;t provide the means to create tests, which could make it impossible to create tests , if not used <em>mocks.</em></p><h2 id=creating-mocks-with-annotations>Creating mocks with annotations</h2><p>The <em>MockK</em> framework provides a set of annotations that can be used to create <em>mocks</em> and inject them into the class to be tested, without this process being explicitly performed. This feature is useful when we need to create several <em>mocks</em> to build the tests and its construction is done by adding <code>io.mockk.impl.annotations.MockK</code> and <code>io.mockk.impl.annotations.InjectMockKs</code> annotations to the variables. declared in the test class.</p><p>After that, we must change the <code>setup</code> method to initialize these variables, as we can see below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.MockKAnnotations
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.InjectMockKs
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.MockK
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.BeforeEach
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithMockKAnnotationTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MockK</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InjectMockKs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>        MockKAnnotations.<span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=reducing-code-when-creating-mocks>Reducing code when creating mocks</h2><p>JUnit offers an interesting feature called <em><a href=https://junit.org/junit5/docs/current/user-guide/#extensions>Extensions</a></em>. With this feature, we can extend the behavior of the test framework, delegating various behaviors that may be necessary for the execution of test scenarios.</p><p>Popular frameworks like <em>Spring</em>, via <code>@SpringBootTest</code> and <em>Micronaut</em>, with <code>@MicronautTest</code> make use of this feature to initialize the context before running scenarios.</p><p>The <em>MockK</em> framework also supports this feature, however, not using a specific annotation, but by an explicit declaration of the JUnit feature, which consists of adding the following annotation to the tests class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@org</span>.junit.jupiter.api.extension.ExtendWith(MockKExtension<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span></code></pre></div><p>With its use, we no longer need, in our test class, we no longer need to declare the <code>setup</code> method, leaving our test class as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.every
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.InjectMockKs
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.impl.annotations.MockK
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> io.mockk.junit5.MockKExtension
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Assertions
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> org.junit.jupiter.api.extension.ExtendWith
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ExtendWith</span>(MockKExtension<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WithMockKExtensionTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@MockK</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> calculatorService: CalculatorService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InjectMockKs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> mainService: MainService
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>.
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>In this text we discuss the dependencies necessary for building tests with Kotlin, using JUnit and MockK tools. We also describe how to build methods, executed before and after test cases, as well as creating <em>mocks</em> for cases where we cannot use a real implementation.</p><p>I hope it helped you understand how to build tests using these tools, as well as how to optimize their construction, demonstrating how to reduce the amount of code needed to build test cases.</p><p>Thanks for reading and feel free to ask questions about it.</p></div><footer><div class=stats><ul class=tags><li><a class=article-terms-link href=https://www.rapatao.com/tags/kotlin/>kotlin</a></li><li><a class=article-terms-link href=https://www.rapatao.com/tags/junit/>junit</a></li><li><a class=article-terms-link href=https://www.rapatao.com/tags/mockk/>mockk</a></li><li><a class=article-terms-link href=https://www.rapatao.com/tags/tests/>tests</a></li></ul></div></footer></article><article class=post><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//rapatao-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><div class=pagination><a href=https://www.rapatao.com/posts/2022-02/load-balancing-what-is-a-load-balancer/ class="button left"><span>Load Balancing: What is a load balancer?</span></a>
<a href=https://www.rapatao.com/posts/2021-06/optimizing-tests-in-spring-boot-applications/ class="button right"><span>Optimizing tests in Spring Boot applications</span></a></div></main><section id=site-sidebar><section id=recent-posts><header><h1>Recent Posts</h1></header><article class=mini-post><a href=https://www.rapatao.com/posts/2022-07/gnupg-how-to-backup-and-restore-your-keys/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-lucas-seebacher-5599449.jpeg')"><img src=https://www.rapatao.com/images/posts/pexels-lucas-seebacher-5599449.jpeg alt="GnuPG: how to backup and restore your keys?"></a><header><h2><a href=https://www.rapatao.com/posts/2022-07/gnupg-how-to-backup-and-restore-your-keys/>GnuPG: how to backup and restore your keys?</a></h2><time class=published datetime="2022-07-31 12:00:00 -0300 -03">July 31, 2022</time></header></article><article class=mini-post><a href=https://www.rapatao.com/posts/2022-04/what-is-a-cdn-cdn-content-delivery-network/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-pixabay-163064.jpeg')"><img src=https://www.rapatao.com/images/posts/pexels-pixabay-163064.jpeg alt="What is a CDN (Content Delivery Network)?"></a><header><h2><a href=https://www.rapatao.com/posts/2022-04/what-is-a-cdn-cdn-content-delivery-network/>What is a CDN (Content Delivery Network)?</a></h2><time class=published datetime="2022-04-21 19:00:00 -0300 -03">April 21, 2022</time></header></article><article class=mini-post><a href=https://www.rapatao.com/posts/2022-02/load-balancing-what-is-a-load-balancer/ class=image style="--bg-image:url('https://www.rapatao.com/images/posts/pexels-brett-sayles-7146867.jpg')"><img src=https://www.rapatao.com/images/posts/pexels-brett-sayles-7146867.jpg alt="Load Balancing: What is a load balancer?"></a><header><h2><a href=https://www.rapatao.com/posts/2022-02/load-balancing-what-is-a-load-balancer/>Load Balancing: What is a load balancer?</a></h2><time class=published datetime="2022-02-05 20:00:00 -0300 -03">February 5, 2022</time></header></article><footer><a href=https://www.rapatao.com/posts/ class=button>See More</a></footer></section></section><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/rapatao target=_blank rel=noopener title=GitHub class="fab fa-github"></a></li><li><a href=//linkedin.com/in/rapatao target=_blank rel=noopener title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//instagram.com/luizrapatao target=_blank rel=noopener title=Instagram class="fab fa-instagram"></a></li><li><a href=//twitter.com/rapatao target=_blank rel=noopener title=Twitter class="fab fa-twitter"></a></li><li><a href=skype:rapatao?userinfo target=_blank rel=noopener title=Skype class="fab fa-skype"></a></li><li><a href=mailto:rapatao@rapatao.com target=_blank title=Email class="far fa-envelope"></a></li></ul><p class=copyright>Â© 2022 rapatao.com<br>Theme: <a href=https://github.com/pacollins/hugo-future-imperfect-slim target=_blank rel=noopener>Hugo Future Imperfect Slim</a><br>A <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP port</a> | Powered by <a href=https://gohugo.io/ title=0.101.0 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a>
<script src=https://www.rapatao.com/js/highlight.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://www.rapatao.com/js/bundle.min.952cb158e7f5f2ed29e105fa1275ab4888785b2b0c0993cc5d3bd09f183bf078.js integrity="sha256-lSyxWOf18u0p4QX6EnWrSIh4WysMCZPMXTvQnxg78Hg="></script>
<script src=https://www.rapatao.com/js/add-on.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LDJ57WEQPH"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LDJ57WEQPH",{anonymize_ip:!0})}</script></div></body></html>